<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Víctor Cantera">
    <link rel="icon" href="../../../../assets/img/comercia_ico.png" type="image/x-icon"/ >
    <title>Autorización 3DS2 (API) - SDK .NET</title>

    <!-- Bootstrap 4.3.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- CSS -->
    <link rel="stylesheet" href="../../../../assets/css/style.css">

    <!-- Script para comprobar los datos de la tarjeta mediante API -->
    <script src="../../../../assets/js/rxp-js.js"></script> <!-- Available at https://github.com/realexpayments -->
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-rpdc mb-3">
        <a class="navbar-brand">
            <img src="../../../../assets/img/log2.svg" width="30" height="30" class="img-fluid" alt="Logo Addon Payments">
            <span class="addonNav">ADDON</span> <span>PAYMENTS</span>
            <span class="d-none d-sm-none d-lg-inline d-xl-inline sdkNav">
                <span>
                    /SDK
                    <span class="barraNav">_</span>
                    de
                    <span class="barraNav">_</span>
                    .NET
                </span>
            </span>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto pl-2 pr-2">
                <li class="nav-item dropdown">
                    <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Inicio
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item pl-2" href="../../../../index.html">Índice</a>
                        <a class="dropdown-item pl-2" href="../../../errores.html">Errores de Addon Payments</a>
                        <a class="dropdown-item pl-2" href="../../../informe.html">Convertir informe</a>
                    </div>
                </li>
                <li class="nav-item ml-1 dropdown">
                    <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Pagos con tarjeta
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <div class="dropdown-header text-center p-0">API</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../01%20-%20Pagos_con_tarjeta/01%20-%20Autorización/index.html">Autorización</a>
                        <a class="dropdown-item pl-2" href="../../01%20-%20Pagos_con_tarjeta/01%20-%20Autorización/DatosDelCliente.html">Datos adicionales</a>
                        <a class="dropdown-item pl-2" href="../../01%20-%20Pagos_con_tarjeta/02%20-%20OTB/index.html">OTB</a>
                        <a class="dropdown-item pl-2" href="../../01%20-%20Pagos_con_tarjeta/03%20-%20Credit/index.html">Credit</a>
                        <hr class="m-0 p-0">
                        <div class="dropdown-header text-center p-0">HPP</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../../HPP/01%20-%20Pagos_con_tarjeta/01%20-%20Autorizacion/index.html">Autorización</a>
                        <a class="dropdown-item pl-2" href="../../../HPP/01%20-%20Pagos_con_tarjeta/02%20-%20OTB/index.html">OTB</a>
                        <a class="dropdown-item pl-2" href="../../../HPP/01%20-%20Pagos_con_tarjeta/03%20-%20Pay%20By%20Link/index.html">Pay By Link</a>
                        <a class="dropdown-item pl-2" href="../../../HPP/01%20-%20Pagos_con_tarjeta/04%20-%20Auth%20con%20iframe/index.html">Iframe</a>
                        <a class="dropdown-item pl-2" href="../../../HPP/01%20-%20Pagos_con_tarjeta/05%20-%20Lightbox/index.html">Lightbox</a>
                    </div>
                </li>
                <li class="nav-item ml-1 dropdown">
                    <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Almacenamiento de tarjeta
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <div class="dropdown-header text-center p-0">API</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/01%20-%20Crear%20un%20cliente/index.html">Crear un cliente</a>
                        <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/02%20-%20Almacenar%20una%20tarjeta/index.html">Almacenar una tarjeta</a>
                        <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/03%20-%20Editar%20tarjeta/index.html">Editar tarjetas</a>
                        <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/04%20-%20Eliminar%20tarjeta/index.html">Eliminar tarjetas</a>
                        <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/05%20-%20Auth/index.html">Autorización</a>
                        <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/06%20-%20Credit/index.html">Credit</a>
                        <hr class="m-0 p-0">
                        <div class="dropdown-header text-center p-0">HPP</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../../HPP/02%20-%20Almacenamiento%20de%20tarjeta/01%20-%20Crear%20un%20cliente/index.html">Crear un cliente</a>
                        <a class="dropdown-item pl-2" href="../../../HPP/02%20-%20Almacenamiento%20de%20tarjeta/02%20-%20Mostrar%20Tarjetas/index.html">Mostrar tarjetas</a>
                    </div>
                </li>
                <li class="nav-item ml-1 dropdown">
                    <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Gestión de transacciones
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item pl-2" href="../../03%20-%20Gestión%20de%20transacciones/01%20-%20Capturar/index.html">Settle (Capturar)</a>
                        <a class="dropdown-item pl-2" href="../../03%20-%20Gestión%20de%20transacciones/02%20-%20Rebate/index.html">Rebate (Devolución)</a>
                        <a class="dropdown-item pl-2" href="../../03%20-%20Gestión%20de%20transacciones/03%20-%20Void/index.html">Void (Anular transacción)</a>
                    </div>
                </li>

                <li class="nav-item ml-1 dropdown">
                    <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Filtro de fraude
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">

                        <div class="dropdown-header text-center p-0">API</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../05%20-%20Fraud%20Management/01%20-%20Fraud%20Filter/index.html">Filtro de fraude</a>
                        <a class="dropdown-item pl-2" href="../../05%20-%20Fraud%20Management/02%20-%20Address%20Verification">Verificación de dirección</a>
                        <a class="dropdown-item pl-2" href="../../05%20-%20Fraud%20Management/03%20-%20Hold">Retener transacción</a>
                        <a class="dropdown-item pl-2" href="../../05%20-%20Fraud%20Management/04%20-%20Lanzamiento">Lanzar transacción</a>
                        <hr class="m-0 p-0">
                        <div class="dropdown-header text-center p-0">HPP</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../../HPP/03%20-%20Fraud%20Management/01%20-%20Fraud%20Filter/index.html">Filtro de fraude</a>
                    </div>
                </li>

                <li class="nav-item ml-1 dropdown">
                    <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        DCC
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <div class="dropdown-header text-center p-0">HPP</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../../HPP/04%20-%20DCC/index.html">Operación con DCC</a>
                    </div>
                </li>
                <li class="nav-item ml-1 dropdown">
                    <a class="nav-link pl-2 dropdown-toggle active" href="#" id="06-3DS2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        3DS2
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        <div class="dropdown-header text-center p-0">API</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2 active" href="#">Autorización</a>
                        <hr class="m-0 p-0">
                        <div class="dropdown-header text-center p-0">HPP</div>
                        <hr class="m-0 p-0">
                        <a class="dropdown-item pl-2" href="../../../HPP/05%20-%203DS2/01%20-%20Autorización/index.html">Autorización</a>
                        <a class="dropdown-item pl-2" href="../../../HPP/05%20-%203DS2/02%20-%20Datos%20adicionales/index.html">Datos adicionales</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    <!-- /NAVBAR -->

    <div class="col-lg-12">
        <div id="contenidoComun" class="container-fluid">
            <div class="row">

                <!-- Menú lateral -->
                <div class="col-lg-2 sticky-top d-none d-sm-none d-lg-block d-xl-block MenuLateral mb-2">

                    <!-- Barra de progreso -->
                    <div class="progress-bar" id="progreso"></div>
                    <!-- /Barra de progreso -->

                    <nav class="navbar sticky-top navbar-light" style="padding: 0px;">
                        <nav class="nav nav-pills flex-column">
                            <a class="nav-link" href="#autorizacion">1. Autorización</a>
                            <nav>
                                <a class="nav-link ml-3 my-1" href="#urlNotificacion">1.0.1 URL de notificacion</a>
                                <a class="nav-link ml-3 my-1" href="#n3DS">1.0.2 Notificación método 3DS</a>
                                <a class="nav-link ml-3 my-1" href="#nACS">1.0.3 Notificación del desafío ACS</a>
                            </nav>
                            <a class="nav-link" href="#datosCliente">2. Recopilar información del dispositivo</a>
                            <a class="nav-link" href="#comprobarVersion">3. Comprobar la versión</a>
                            <a class="nav-link" href="#obtenerInfo">4. Obtener información del ACS</a>
                            <a class="nav-link" href="#startAuth">5. Iniciar autenticación</a>
                            <nav>
                                <a class="nav-link ml-3 my-1" href="#exenciones">5.1 Exenciones</a>
                                <a class="nav-link ml-3 my-1" href="#solicitudMuestra">5.2 Solicitud de muestra</a>
                                <a class="nav-link ml-3 my-1" href="#adicionalFields">5.3 Campos opcionales</a>
                            </nav>
                            <a class="nav-link" href="#authFlujos">6. Flujos de autenticación</a>
                            <nav>
                                <a class="nav-link ml-3 my-1" href="#flujoSinFric">6.1 Flujo sin fricción</a>
                                <a class="nav-link ml-3 my-1" href="#flujoConFric">6.2 Flujo con fricción</a>
                            </nav>
                            <a class="nav-link" href="#desafioAcs">7. Desafío ACS</a>
                            <nav>
                                <a class="nav-link ml-3 my-1" href="#simuladorImg">7.1 Simulador ACS</a>
                            </nav>
                            <a class="nav-link" href="#obtenerDatosAuth">8. Obtener datos de autenticación</a>
                            <a class="nav-link" href="#authDocs"> 9. Autorización</a>
                            <a class="nav-link" href="#FormEjemplo1">10. Formulario de ejemplo</a>
                            <nav>
                                <a class="nav-link ml-3 my-1" href="#Formulario">10.1 Formulario</a>
                                <a class="nav-link ml-3 my-1" href="#respuestaForm">10.2 Respuesta de operación</a>
                            </nav>
                        </nav>
                    </nav>
                </div>
                <!-- /Menú lateral -->
                <!-- Contenido común -->
                <div class="col-lg-10">

                    <!-- Punto 1-->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 id="autorizacion" class="titulo">
                                1. Autorización
                            </h3>

                            <hr>

                            <p>
                                Una vez capturados los datos de la tarjeta en su aplicación, puede enviarlos a Addon Payments para que se verifiquen, saneen y formateen de la forma correcta para su porterior procesamiento en nuestros servidores. Los comercios que capturan datos en su aplicación (y en su servidor) deben ser conscientes de sus <a target="_blank" href="https://www.pcisecuritystandards.org/">responsabilidades de cumplimiento de PCI DSS.</a>
                            </p>
                            <p class="alert alert-danger" role="alert">
                                Recomendamos encarecidamente sanear los datos del titular de la tarjeta antes de enviarla en la solicitud. Por ejemplo, debe comprobar que el número de tarjeta es válido y que la fecha de caducidad es correcta. <a target="_blank" href="https://github.com/globalpayments/rxp-js">Nuestra biblioteca JS</a> contiene un conjunto de funciones útiles que le ayudan a procesar las solicitudes correctamente.
                                <small class="form-text text-muted">
                                    --> En los ejemplos de esta documentación usamos el fichero de comprobación JS rxp-js.js de RealexPayments. Podrá ver el fichero en la carpeta de "assets/js".
                                </small>
                            </p>

                            <h5 class="pt-3" id="urlNotificacion">1.0.1 URL de notificación</h5>

                            <hr>

                            <p>
                                Lo primero que debemos hacer antes de probar o implementar 3D Secure 2 es instalar y configurar los endpoints en su sitio web que recibirán notificaciones de eventos y datos del servidor de control de acceso del emisor (ACS). Debe ser capaz de aceptar HTTP POST con valores codificados en Base64url. Se utiliza en dos momentos clave durante la autenticación:
                            </p>
                            <ul>
                                <li>
                                    <b>Finalización del método 3DS:</b> Este endpoint le indica a su sitio web que el ACS ha completado la creación de perfiles del navegador. El método POST simplemente contiene el identificador único de Addon Payments para la autenticación 3D Secure (ID de transacción del servidor).
                                </li>
                                <br>
                                <li>
                                    <b>Finalización del desafío ACS:</b> Este endpoint le indica a su sitio web que el desafío presentado al cliente se ha completado. La petición POST también contiene datos clave de autenticación, incluido si el cliente se autenticó correctamente o no.
                                </li>
                            </ul>

                            <hr>

                            <h5 class="pt-3" id="n3DS">1.0.2 Notificación método 3DS</h5>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class=" comments">// Los ejemplos de código que no pertenecen al SDK que se utilizan en este artículo son ejemplos simples y no deben usarse como código listo para producción.</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">threeDSMethodData = Request.Form[</span><span class="orange">"threeDSMethodData"</span><span class="variables">];</span>
                                    <br>
                                    <br>
                                    <span class=" comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                    <br>
                                    <span class="new">try </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-4  new">byte</span><span class="variables">[] data = Convert.</span><span class="imports">FromBase64String</span><span class="variables">(threeDSMethodData);</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">methodUrlResponseString = Encoding.UTF8.</span><span class="imports">GetString</span><span class="variables">(data);</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 comments">// Mapear con su clase personalizada "MethodUrlResponse"</span>
                                    <br>
                                    <span class="pl-4 imports">MethodUrlResponse</span> <span class="variables">methodUrlResponse = JsonConvert.</span><span class="imports">DeserializeObject</span><span class="variables"><</span><span class="imports">MethodUrlResponse</span><span class="variables">>(methodUrlResponseString);</span>
                                    <br>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">threeDSServerTransID = methodUrlResponse.ThreeDSServerTransID;</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 comments">// Notificar al cliente que el método se ha completado</span>
                                    <br>
                                    <br>
                                    <span class="variables">}</span><span class="new"> catch </span><span class="variables">(</span><span class="imports">ApiException </span><span class="variables">exce</span><span class="variables">) {</span>
                                    <br>
                                    <span class="pl-4 comments">// Añada aquí su tratamiento de errores</span>
                                    <br>
                                    <span class="pl-4 new">return </span><span class="variables">Ok(exce);</span>
                                    <br>
                                    <span class="variables">}</span>
                                </code>
                            </div>

                            <hr>

                            <h5 class="pt-3" id="nACS">1.0.3 Notificación del desafío ACS</h5>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class=" comments">// Los ejemplos de código que no pertenecen al SDK que se utilizan en este artículo son ejemplos simples y no deben usarse como código listo para producción.</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">cres = Request.Form[</span><span class="orange">"cres"</span><span class="variables">];</span>
                                    <br>
                                    <br>
                                    <span class=" comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                    <br>
                                    <span class="new">try </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-4  new">byte</span><span class="variables">[] data = Convert.</span><span class="imports">FromBase64String</span><span class="variables">(cres);</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">challengeUrlResponseString = Encoding.UTF8.</span><span class="imports">GetString</span><span class="variables">(data);</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 comments">// Mapear con su clase personalizada "ChallengeUrlResponse"</span>
                                    <br>
                                    <span class="pl-4 imports">ChallengeUrlResponse</span> <span class="variables">challengeUrlResponse = JsonConvert.</span><span class="imports">DeserializeObject</span><span class="variables"><</span><span class="imports">ChallengeUrlResponse</span><span class="variables">>(challengeUrlResponseString);</span>
                                    <br>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">threeDSServerTransID = challengeUrlResponse.ThreeDSServerTransID;</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">acsTransId = challengeUrlResponse.AcsTransID;</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">challengeCompletionInd = challengeUrlResponse.ChallengeCompletionInd;</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">messageType = challengeUrlResponse.MessageType;</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">messageVersion = challengeUrlResponse.MessageVersion;</span>
                                    <br>
                                    <span class="pl-4  new">string</span> <span class="variables">transStatus = challengeUrlResponse.TransStatus;</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 comments">// Notificar al cliente que el método se ha completado</span>
                                    <br>
                                    <br>
                                    <span class="variables">}</span><span class="new"> catch </span><span class="variables">(</span><span class="imports">ApiException </span><span class="variables">exce</span><span class="variables">) {</span>
                                    <br>
                                    <span class="pl-4 comments">// Añada aquí su tratamiento de errores</span>
                                    <br>
                                    <span class="pl-4 new">return </span><span class="variables">Ok(exce);</span>
                                    <br>
                                    <span class="variables">}</span>
                                </code>
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 1-->
                    <!-- Punto 2-->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="datosCliente">
                                2. Recopilar información del dispositivo
                            </h3>

                            <hr>

                            <p>
                                En la primera solicitud para iniciar 3D Secure 2 (iniciar la autenticación) además de los detalles de facturación y envío del cliente y la información de la transacción, también debemos proporcionar los datos del navegador.
                                Puede recopilar estos datos independientemente del proceso de autenticación de 3D Secure, por ejemplo, cuando ingrese el cliente en su web.
                            </p>
                            <p class="alert alert-primary mt-4" role="alert">
                                Algunos dispositivos pueden devolver una profundidad de color que no está en la lista de valores aceptados, en este escenario EMVCo.
                                La recomendación es enviar el valor más bajo más cercano, por ejemplo, si la profundidad de color devuelta por el navegador es 30, envíe 24 ya que este es el valor más bajo más cercano.
                            </p>

                            <p>
                                En nuestros ejemplos a continuación, recopilamos tantos datos como podamos en el lado del cliente utilizando JavaScript.
                                Para algunas de las variables (browserLanguage, userAgent y timeZoneOffSet) también puede usar métodos del lado del servidor.
                            </p>

                            <div class="p-4 mb-4 panelCode">
                                <code>
                                    <span class="pl-2 new"><</span><span class="script">script</span><span class="new">></span>
                                    <br>
                                    <span class="pl-4 require">function </span><span class="service">gatherBrowserData</span><span class="require">() {</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">colorDepth</span> <span class="require">=</span> <span class="service">screen</span><span class="require">.</span><span class="variables">colorDepth</span><span class="require">;</span> <span class="comments">// 24</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">javaEnabled</span> <span class="require">=</span> <span class="service">navigator</span><span class="require">.</span><span class="service">javaEnabled</span><span class="require">();</span> <span class="comments">// true</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">browserLanguage</span> <span class="require">=</span> <span class="service">navigator</span><span class="require">.</span><span class="variables">language</span><span class="require">;</span> <span class="comments">// en_US</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">screenHeight</span> <span class="require">=</span> <span class="service">screen</span><span class="require">.</span><span class="variables">height</span><span class="require">;</span> <span class="comments">// 1080</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">screenWidth</span> <span class="require">=</span> <span class="service">screen</span><span class="require">.</span><span class="variables">width</span><span class="require">;</span> <span class="comments">// 1920</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">userAgent</span> <span class="require">=</span> <span class="service">navigator</span><span class="require">.</span><span class="variables">userAgent</span><span class="require">;</span>
                                    <br>
                                    <span class="pl-5 comments">// Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">browserTime</span> <span class="require">=</span> <span class="new">new </span><span class="service">Date</span><span class="require">();</span>
                                    <br>
                                    <span class="pl-5 new">var </span><span class="variables">browserTimezoneZoneOffset</span> <span class="require">= (</span><span class="variables">browserTime</span><span class="require">.</span><span class="service">getTimezoneOffset</span><span class="require">() / </span><span class="variables">60</span><span class="require">);</span> <span class="comments">// 0</span>
                                    <br>
                                    <span class="pl-4 require">}</span>
                                    <br>
                                    <span class="pl-2 new"><</span><span class="script">/script</span><span class="new">></span>
                                </code>
                            </div>

                            <p>
                                <b>Muestra del lado servidor</b>
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="new">string</span> <span class="variables">customerIp = Request.</span><span class="imports">ServerVariables</span><span class="variables"><</span><span class="orange">"REMOTE_ADDR"</span><span class="variables">];</span> <span class="comments">// 123.123.123.123</span>
                                    <br>
                                    <span class="new">string</span> <span class="variables">acceptHeader = Request.</span><span class="imports">ServerVariables</span><span class="variables"><</span><span class="orange">"HTTP_ACCEPT"</span><span class="variables">];</span>
                                    <br>
                                    <span class="comments">// text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span>
                                </code>
                            </div>

                        </div>
                    </div>
                    <!-- /Punto 2 -->
                    <!-- Punto 3-->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="comprobarVersion">
                                3. Comprobar la versión
                            </h3>

                            <hr>

                            <p>
                                El primer paso es verificar la versión que admite la tarjeta. Addon Payments mantiene una base de datos actualizada de los rangos de BIN y las versiones de 3D Secure que admiten.
                            </p>
                            <p>
                                Si la tarjeta está inscrita en 3D Secure 2, se devolverá la versión exacta (2.xx) junto con la URL necesaria para facilitar la recopilación de datos del dispositivo por parte del Emisor ACS (si es compatible).
                                Si la tarjeta no está inscrita, el único valor devuelto será inscrito = falso. En este escenario, puede proceder a verificar si la tarjeta está inscrita en 3D Secure 1. <a href="https://developer.globalpay.com/api/3d-secure">Para obtener más información consulte la documentación de 3D Secure 1.</a>
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Entities;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.PaymentMethods;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Services;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">Microsoft.AspNetCore.Mvc;</span>
                                    <br>
                                    <br>
                                    <span class="etiqueta">namespace </span><span class="variables">AddonPayments.Controllers._3DS2 {</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">ApiController</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">Route</span><span class="variables">(</span><span class="orange">"api/[Controller]"</span><span class="variables">)]</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 etiqueta">public class </span><span class="imports">ComprobarVersionController</span><span class="variables">: </span><span class="imports">ControllerBase </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-5 variables">[</span><span class="imports">HttpPost</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-5 etiqueta">public </span><span class="service">IActionResult </span><span class="variables">CheckVersion() {</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Configuramos los datos de nuestro comercio. Los datos son proporcionados por el equipo de Addon Payments,</span>
                                    <br>
                                    <span class="pl-6 comments">// en caso de duda debe llamar al 914 353 028 e indicar su número de comercio o Merchant ID</span>
                                    <br>
                                    <span class="pl-6 imports">ServicesContainer</span><span class="variables">.ConfigureService(</span><span class="new">new </span><span class="imports">GatewayConfig </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantId = </span><span class="orange">"addonnettest"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">AccountId = </span><span class="orange">"3ds2"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">SharedSecret = </span><span class="orange">"secret"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MethodNotificationUrl = </span><span class="orange">"https://dominio.com/notificacion3ds"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ChallengeNotificationUrl = </span><span class="orange">"https://dominio.com/notificacionAcs"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantContactUrl = </span><span class="orange">"https://dominio.com/about"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Secure3dVersion = </span><span class="service">Secure3dVersion</span><span class="variables">.Two</span>
                                    <br>
                                    <span class="pl-6 variables">});</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Creamos el objeto de la tarjeta</span>
                                    <br>
                                    <span class="pl-6 comments">// Frictionless: 4263970000005262</span>
                                    <br>
                                    <span class="pl-6 comments">// Challenge: 4012001038488884</span>
                                    <br>
                                    <span class="pl-6 new">var </span><span class="variables">card = </span><span class="new">new </span><span class="imports">CreditCardData </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">Number = </span><span class="orange">"4263970000005262"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 imports">ThreeDSecure</span> <span class="variables">threeDSecureData =</span> <span class="new">null</span><span class="variables">;</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                    <br>
                                    <span class="pl-6 new">try </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">threeDSecureData = Secure3dService.</span><span class="imports">CheckEnrollment</span><span class="variables">(card)</span>
                                    <br>
                                    <span class="pl-9 variables">.Execute();</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">enrolled = threeDSecureData.Enrolled;</span> <span class="comments">// True</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">serverTransactionId = threeDSecureData.ServerTransactionId;</span> <span class="comments">// af65c369-59b9-4f8d-b2f6-7d7d5f5c69d5</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">dsStartProtocolVersion = threeDSecureData.DirectoryServerStartVersion;</span> <span class="comments">// 2.1.0</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">dsEndProtocolVersion = threeDSecureData.DirectoryServerEndVersion;</span> <span class="comments">// 2.1.0</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">acsStartProtocolVersion = threeDSecureData.AcsStartVersion;</span><span class="comments">// 2.1.0</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">acsEndProtocolVersion = threeDSecureData.AcsEndVersion;</span> <span class="comments">// 2.1.0</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">methodUrl = threeDSecureData.IssuerAcsUrl;</span> <span class="comments">// https://www.acsurl.com/method</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">encodedMethodData = threeDSecureData.PayerAuthenticationRequest;</span> <span class="comments">//  Base64 encoded string</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 comments">// Devolvemos la respuesta asociando los parámetros recibidos por el servidor al cliente</span>
                                    <br>
                                    <span class="pl-7 comments">// para más información puede ver el controlador "ComprobarVersionController.cs"</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 comments">// Aconsejamos guardar los datos de la operacion en su base de datos en caso de querer gestionar de forma interna sus transacciones</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 variables">}</span><span class="new"> catch </span><span class="variables">(</span><span class="imports">ApiException </span><span class="variables">exce</span><span class="variables">) {</span>
                                    <br>
                                    <span class="comments pl-7">// Añada aquí su tratamiento de errores</span>
                                    <br>
                                    <span class="pl-7 new">return </span><span class="variables">Ok(exce);</span>
                                    <br>
                                    <span class="pl-6 variables">}</span>
                                    <br>
                                    <span class="pl-5 variables">}</span>
                                    <br>
                                    <span class="pl-4 variables">}</span>
                                    <br>
                                    <span class="variables">}</span>
                                </code>
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 3 -->
                    <!-- Punto 4 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="obtenerInfo">
                                4. Obtener la infromación
                            </h3>

                            <hr>

                            <p>
                                Si el Emisor ACS admite la recopilación de datos del dispositivo, en la respuesta a la verificación de versión se devolverá la URL del Método ACS.
                                En el lado del cliente, debemos abrir un iFrame oculto dirigido a la URL del método 3DS ACS enviando el objeto de datos del método 3DS.
                            </p>
                            <p>
                                El objeto de datos del método 3DS es un objeto JSON codificado en Base64url que contiene el ID de transacción del servidor y la URL de notificación del método.
                                Esto se devolvió en respuesta a la verificación de la versión de 3D Secure.
                            </p>
                            <p>
                                En caso de que el Emisor ACS no admita datos del dispositivo, no se devolverá la URL del método y podrá pasar al siguiente paso mientras configura el indicador de finalización del método 3DS como no disponible.
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="pl-2 new"><</span><span class="script">script</span><span class="new">></span>
                                    <br>
                                    <span class="pl-4 require">var </span><span class="variables">form </span><span class="require">= document.</span><span class="service">createElement</span><span class="require">("</span><span class="green">form</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">method</span><span class="require">", "</span><span class="green">POST</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">action</span><span class="require">", "</span><span class="green">https://www.acsurl.com/method</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">id</span><span class="require">", "</span><span class="green">formIframe</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">target</span><span class="require">", "</span><span class="green">hidden_iframe</span><span class="require">");</span>
                                    <br>
                                    <br>
                                    <span class="pl-5 require">var </span><span class="variables">threeDSMethodData </span><span class="require">= document.</span><span class="service">createElement</span><span class="require">("</span><span class="green">input</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">threeDSMethodData</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">type</span><span class="require">", "</span><span class="green">hidden</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">threeDSMethodData</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">name</span><span class="require">", "</span><span class="green">threeDSMethodData</span><span class="require">");</span>
                                    <br>
                                    <br>
                                    <span class="pl-5 comments">// Añadir el JSON devuelto por Addon Payments</span>
                                    <br>
                                    <span class="pl-5 variables">threeDSMethodData</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">value</span><span class="require">", </span><span class="variables">threeDSmethodDataObject</span><span class="require">);</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">appendChild</span><span class="require">(</span><span class="variables">threeDSMethodData</span><span class="require">);</span>
                                    <br>
                                    <span class="pl-5 variables">document.body.</span><span class="require">.</span><span class="service">appendChild</span><span class="require">(</span><span class="variables">form</span><span class="require">);</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">submit</span><span class="require">();</span>
                                    <br>
                                    <span class="pl-2 new"><</span><span class="script">/script</span><span class="new">></span>
                                </code>
                            </div>

                            <p class="pt-3">
                                Si la URL del método ACS recopila correctamente la información del dispositivo, en el iFrame enviará un formulario POST y redirigirá el navegador a su URL de notificación. Su código del lado del cliente podrá detectar la redirección y cerrar el iFrame oculto en consecuencia.
                                La recopilación de datos del dispositivo debe completarse en segundos, lo que permite que su aplicación continúe con el siguiente paso, estableciendo el indicador de finalización del método 3DS en verdadero.
                            </p>
                            <p>
                                Si la recopilación de información del dispositivo no tiene éxito, el tiempo de espera máximo establecido por el ACS es de 10 segundos. Sin embargo, es posible que desee continuar con el siguiente paso antes.
                                En este caso, su aplicación debe cerrar el iFrame dentro de su período de tiempo determinado (por ejemplo, 3 segundos) y establecer el indicador de finalización del método 3DS en Falso en la siguiente solicitud.
                            </p>
                        </div>
                    </div>
                    <!-- /Punto 4 -->
                    <!-- Punto 5 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="startAuth">
                                5. Iniciar autenticación
                            </h3>

                            <hr>

                            <p>
                                Suponiendo que ya haya recopilado los datos relevantes del dispositivo y (condicionalmente) que el proceso de URL del método ACS esté completo,
                                su aplicación ahora puede iniciar la autenticación 3D Secure 2. A continuación, describimos los datos requeridos y recomendados que se enviarán en la petición POST al endpoint de autenticación.
                                Esto incluye los detalles de facturación y envío del cliente, al menos un número de teléfono, los datos del dispositivo y los detalles de la transacción (importe, moneda, etc.).
                            </p>
                            <p>
                                También debe incluir la URL de notificación del ACS (1.0.3 Notificación del desafío ACS) de su aplicación, una bandera que indique el resultado de la URL del método ACS (o si tuvo lugar) y un enlace a una página
                                "Acerca de" o "Contacto" de su sitio web con información de atención al cliente.
                            </p>

                            <hr>

                            <h5 class="pt-1" id="exenciones">
                                5.1 Exenciones
                            </h5>

                            <p>
                                Una de las ventajas clave de 3D Secure 2 es que proporciona un marco para que los comerciantes se beneficien de las exenciones de SCA en determinadas condiciones.
                                La idea detrás de estas exenciones es permitir el desarrollo de una experiencia de pago fácil de usar en circunstancias donde el riesgo es bajo.
                            </p>

                            <p>
                                El Emisor puede aplicar exenciones en función de los detalles de la transacción o el comerciante puede solicitarlas específicamente, con el permiso de su adquirente. En el mensaje de autenticación,
                                puede solicitar una exención incluyéndola en el campo Indicador de solicitud de desafío (consulte la nota a continuación).
                            </p>

                            <p class="alert alert-danger" role="alert">
                                Cuando un comercio solicita una exención, ya no podrá hacer uso de un cambio de responsabilidad en caso de una devolución de cargo.
                                <small class="form-text text-muted">
                                    --> Para solicitudes de exención de Mastercard, consulte también nuestra <a href="https://developer.globalpay.com/ecommerce/3d-secure-version2/message-extension#mastercard">documentación de mensajes de Mastercard.</a>
                                </small>
                            </p>

                            <hr>

                            <h5 class="pt-1" id="solicitudMuestra">
                                5.2 Solicitud de muestra
                            </h5>

                            <p>
                                En este ejemplo, solo estamos pasando campos obligatorios junto con algunos recomendados.
                                Cuantos más campos opcionales envíe y los datos que proporcione, es más probable que la autenticación de la transacción sea fluida.
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="etiqueta">using </span><span class="variables">System;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Entities;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.PaymentMethods;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Services;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">Microsoft.AspNetCore.Mvc;</span>
                                    <br>
                                    <br>
                                    <span class="etiqueta">namespace </span><span class="variables">AddonPayments.Controllers._3DS2 {</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">ApiController</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">Route</span><span class="variables">(</span><span class="orange">"api/[Controller]"</span><span class="variables">)]</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 etiqueta">public class </span><span class="imports">IniciarAuthController</span><span class="variables">: </span><span class="imports">ControllerBase </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-5 variables">[</span><span class="imports">HttpPost</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-5 etiqueta">public </span><span class="service">IActionResult </span><span class="variables">IniciarAuth() {</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Configuramos los datos de nuestro comercio. Los datos son proporcionados por el equipo de Addon Payments,</span>
                                    <br>
                                    <span class="pl-6 comments">// en caso de duda debe llamar al 914 353 028 e indicar su número de comercio o Merchant ID</span>
                                    <br>
                                    <span class="pl-6 imports">ServicesContainer</span><span class="variables">.ConfigureService(</span><span class="new">new </span><span class="imports">GatewayConfig </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantId = </span><span class="orange">"addonnettest"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">AccountId = </span><span class="orange">"3ds2"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">SharedSecret = </span><span class="orange">"secret"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MethodNotificationUrl = </span><span class="orange">"https://dominio.com/notificacion3ds"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ChallengeNotificationUrl = </span><span class="orange">"https://dominio.com/notificacionAcs"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantContactUrl = </span><span class="orange">"https://dominio.com/about"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Secure3dVersion = </span><span class="service">Secure3dVersion</span><span class="variables">.Two</span>
                                    <br>
                                    <span class="pl-6 variables">});</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Creamos el objeto de la tarjeta</span>
                                    <br>
                                    <span class="pl-6 comments">// Frictionless: 4263970000005262</span>
                                    <br>
                                    <span class="pl-6 comments">// Challenge: 4012001038488884</span>
                                    <br>
                                    <span class="pl-6 new">var </span><span class="variables">card = </span><span class="new">new </span><span class="imports">CreditCardData </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">Number = </span><span class="orange">"4263970000005262"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ExpMonth = </span><span class="imports">12</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ExpYear = </span><span class="imports">2025</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Cvn = </span><span class="orange">"131"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">CardHolderName = </span><span class="orange">"Nombre del titular"</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Datos de facturación</span>
                                    <br>
                                    <span class="pl-6 imports">Address </span><span class="variables">billingAddress = </span><span class="new">new </span><span class="imports">Address </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">StreetAddress1 = </span><span class="orange">"Dirección de facturación 1"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">StreetAddress2 = </span><span class="orange">"Dirección de facturación 2"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">StreetAddress3 = </span><span class="orange">"Dirección de facturación 3"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">City = </span><span class="orange">"Ciudad"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Province = </span><span class="orange">"Provincia"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">State = </span><span class="orange">"País"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">PostalCode = </span><span class="orange">"Código psotal"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Country = </span><span class="orange">"ISO del país (ES, GB, US...)"</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Datos de envío</span>
                                    <br>
                                    <span class="pl-6 imports">Address </span><span class="variables">shippingAddress = </span><span class="new">new </span><span class="imports">Address </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">StreetAddress1 = </span><span class="orange">"Dirección de envío 1"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">StreetAddress2 = </span><span class="orange">"Dirección de envío 2"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">StreetAddress3 = </span><span class="orange">"Dirección de envío 3"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">City = </span><span class="orange">"Ciudad"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">PostalCode = </span><span class="orange">"Código psotal"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Country = </span><span class="orange">"ISO del país (ES, GB, US...)"</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Capturamos los datos del navegador del cliente</span>
                                    <br>
                                    <span class="pl-6 imports">BrowserData </span><span class="variables">browserData = </span><span class="new">new </span><span class="imports">BrowserData </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">AcceptHeader = </span><span class="orange">"text/html,application/xhtml+xml,application/xml;q=9,image/webp,img/apng,/;q=0.8"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ColorDepth = ColorDepth.</span><span class="imports">TWENTY_FOUR_BITS</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">IpAddress = </span><span class="orange">"123.123.123.123"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">JavaEnabled = </span><span class="new">True</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Language = </span><span class="orange">"es"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ScreenHeight = </span><span class="new">1080</span>
                                    <br>
                                    <span class="pl-7 variables">ScreenWidth = </span><span class="new">1920</span>
                                    <br>
                                    <span class="pl-7 variables">ChallengeWindowSize = ChallengeWindowSize.</span><span class="imports">FULL_SCREEN</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Timezone = </span><span class="orange">"0"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">UserAgent = </span><span class="orange">"Mozilla/5.0 (Windows NT 6.1; Win64, x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 imports">ThreeDSecure</span> <span class="variables">threeDSecureData =</span> <span class="imports">ThreeDSecure</span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">ServerTransactionId = </span> <span class="orange">"9de5bccf-c438-4024-8961-ec4b3cff15ff"</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                    <br>
                                    <span class="pl-6 new">try </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">threeDSecureData = Secure3dService.</span><span class="imports">InitiateAuthentication</span><span class="variables">(card, threeDSecureData)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithAmount(</span><span class="imports">10.01m</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithCurrency(</span><span class="orange">"EUR"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithOrderCreateDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2019-09-09T11:19:12</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithCustomerEmail(<span class="orange">"james.mason@example.com"</span>)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithAddress(billingAddress,</span> <span class="imports">AddressType</span><span class="variables">.Billing)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithAddress(shippingAddress,</span> <span class="imports">AddressType</span><span class="variables">.Shipping)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithBrowserData(browserData)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithMethodUrlCompletion(</span><span class="imports">MethodUrlCompletion</span><span class="variables">.YES)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithMobileNumber(</span><span class="orange">"34"</span><span class="variables">,</span> <span class="orange">"914353028"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-9 variables">.Execute();</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">status = threeDSecureData.Status;</span> <span class="comments">// AUTHENTICATION_SUCCESSFUL or CHALLENGE_REQUIRED</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 comments">// Para más información puede ver el controlador "IniciarAuthController.cs"</span>
                                    <br>
                                    <span class="pl-7 comments">// Aconsejamos guardar los datos de la operacion en su base de datos en caso de querer gestionar de forma interna sus transacciones</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 variables">}</span><span class="new"> catch </span><span class="variables">(</span><span class="imports">ApiException </span><span class="variables">exce</span><span class="variables">) {</span>
                                    <br>
                                    <span class="comments pl-7">// Añada aquí su tratamiento de errores</span>
                                    <br>
                                    <span class="pl-7 new">return </span><span class="variables">Ok(exce);</span>
                                    <br>
                                    <span class="pl-6 variables">}</span>
                                    <br>
                                    <span class="pl-5 variables">}</span>
                                    <br>
                                    <span class="pl-4 variables">}</span>
                                    <br>
                                    <span class="variables">}</span>
                                </code>
                            </div>

                            <hr>

                            <h5 class="pt-1" id="adicionalFields">
                                5.3 Campos opcionales
                            </h5>

                            <p>
                                3D Secure 2 permite el envío de un conjunto de datos mucho mayor que su predecesor.
                                Cuantos más datos se envíen, más información tendrá el Emisor al tomar la decisión de si la autenticación de la transacción debe realizarse a través de un flujo sin fricción o de desafío.
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="comments">// Datos obligatorios para la autenticación 3DS2</span>
                                    <br>
                                    <span class="variables">threeDSecureData = Secure3dService.</span><span class="imports">InitiateAuthentication</span><span class="variables">(card, threeDSecureData)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAmount(</span><span class="imports">10.01m</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithCurrency(</span><span class="orange">"EUR"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithOrderCreateDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2019-09-09T11:19:12</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithCustomerEmail(<span class="orange">"james.mason@example.com"</span>)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAddress(billingAddress,</span> <span class="imports">AddressType</span><span class="variables">.Billing)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAddress(shippingAddress,</span> <span class="imports">AddressType</span><span class="variables">.Shipping)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithBrowserData(browserData)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithMethodUrlCompletion(</span><span class="imports">MethodUrlCompletion</span><span class="variables">.YES)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithMobileNumber(</span><span class="orange">"34"</span><span class="variables">,</span> <span class="orange">"914353028"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 comments">// Datos adicionales</span>
                                    <br>
                                    <span class="pl-4 variables">.WithHomeNumber(</span><span class="orange">"34"</span><span class="variables">,</span> <span class="orange">"914353028"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithWorkNumber(</span><span class="orange">"34"</span><span class="variables">,</span> <span class="orange">"914353028"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithMerchantInitiatedRequestType(</span><span class="imports">AuthenticationRequestType</span><span class="variables">.RECURRING_TRANSACTION)</span>
                                    <br>
                                    <span class="pl-4 comments">// Información de tarjeta regalo</span>
                                    <br>
                                    <span class="pl-4 variables">.WithGiftCardCount(</span><span class="imports">1</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithGiftCardCurrency(</span><span class="orange">"EUR"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithGiftCardAmount(</span><span class="imports">5</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 comments">// Información adicional de la orden</span>
                                    <br>
                                    <span class="pl-4 variables">.WithDeliveryEmail(</span><span class="orange">"victor.cantera@example.com"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithDeliveryTimeFrame(</span><span class="imports">DeliveryTimeFrame</span><span class="variables">.ELECTRONIC_DELIVERY)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithShippingMethod(</span><span class="imports">ShippingMethod</span><span class="variables">.VERIFIED_ADDRESS)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithShippingNameMatchesCardHolderName(</span><span class="new">true)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPreOrderIndicator(</span><span class="imports">PreOrderIndicator</span><span class="variables">.MERCHANDISE_AVAILABLE)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPreOrderAvailabilityDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithReorderIndicator(</span><span class="imports">ReorderIndicator</span><span class="variables">.FIRST_TIME_ORDER)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithOrderTransactionType(</span><span class="imports">OrderTransactionType</span><span class="variables">.GOODS_SERVICE_PURCHASE)</span>
                                    <br>
                                    <span class="pl-4 comments">// Información adicional del pagador </span>
                                    <br>
                                    <span class="pl-4 variables">.WithCustomerAccountId(</span><span class="orange">"6dcb24f5-74a0-4da3-98da-4f0aa0e88db3"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAccountAgeIndicator(</span><span class="imports">AgeIndicator</span><span class="variables">.LESS_THAN_THIRTY_DAYS)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAccountCreateDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAccountChangeDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithAccountChangeIndicator(</span><span class="imports">AgeIndicator</span><span class="variables">.THIS_TRANSACTION)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPasswordChangeDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPasswordChangeIndicator(</span><span class="imports">AgeIndicator</span><span class="variables">.LESS_THAN_THIRTY_DAYS)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPaymentAccountCreateDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPaymentAccountAgeIndicator(</span><span class="imports">AgeIndicator</span><span class="variables">.LESS_THAN_THIRTY_DAYS)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPreviousSuspiciousActivity(</span><span class="new">false</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithNumberOfPurchasesInLastSixMonths(</span><span class="imports">3</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithNumberOfTransactionsInLast24Hours(</span><span class="imports">1</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithNumberOfTransactionsInLastYear(</span><span class="imports">5</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithNumberOfAddCardAttemptsInLast24Hours(</span><span class="imports">1</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithShippingAddressCreateDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithShippingAddressUsageIndicator(</span><span class="imports">AgeIndicator</span><span class="variables">.THIS_TRANSACTION)</span>
                                    <br>
                                    <span class="pl-4 comments">// Datos adicionales Prior 3DS2 </span>
                                    <br>
                                    <span class="pl-4 variables">.WithPriorAuthenticationMethod(</span><span class="imports">PriorAuthenticationMethod</span><span class="variables">.FRICTIONLESS_AUTHENTICATION)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPriorAuthenticationTransactionId(</span><span class="orange">"26c3f619-39a4-4040-bf1f-6fd433e6d615"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPriorAuthenticationTimestamp(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2019-09-01T12:25:14</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithPriorAuthenticationData(</span><span class="orange">"cKTYtrvvKU7gUoiqbbO7Po"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 comments">// Datos adicionales de petición recurrente</span>
                                    <br>
                                    <span class="pl-4 variables">.WithMaxNumberOfInstallments(</span><span class="imports">5</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithRecurringAuthorizationFrequency(</span><span class="imports">25</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithRecurringAuthorizationExpiryDate(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2020-01-01</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 comments">// Datos adicionales del login del pagador</span>
                                    <br>
                                    <span class="pl-4 variables">.WithCustomerAuthenticationMethod(</span><span class="imports">CustomerAuthenticationMethod</span><span class="variables">.MERCHANT_SYSTEM_AUTHENTICATION)</span>
                                    <br>
                                    <span class="pl-4 variables">.WithCustomerAuthenticationTimestamp(DateTime.</span><span class="imports">Parse</span><span class="variables">(</span><span class="orange">2019-09-09T11:14:55</span><span class="variables">)</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-4 variables">.Execute()</span>
                                    <br>
                                    <br>
                                </code>
                            </div>

                            <p class="alert alert-primary mt-4" role="alert">
                                Puede ver la información detallada de cada propiedad en la <a target="_blank" href="https://developer.globalpay.com/api/3d-secure-two#3ds2-optional-fields">documentación oficial.</a>
                            </p>

                        </div>
                    </div>
                    <!-- /Punto 5 -->
                    <!-- Punto 6 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="authFlujos">
                                6. Flujos de autenticación
                            </h3>

                            <hr>

                            <p>
                                En este punto, el Emisor analizará la transacción. Tendrá en cuenta factores como los datos que su aplicación ha proporcionado junto con el comportamiento histórico del cliente y el análisis de transacciones.
                                El resultado de este proceso determinará si el Emisor decide que el cliente debe autenticar aún más la transacción y realizar una comprobación con el ACS (flujo con fricción).
                            </p>

                            <hr>

                            <h5 class="pt-1" id="flujoSinFric">
                                6.1 Flujo sin fricción
                            </h5>

                            <p>
                                En un flujo sin fricciones, el Emisor puede determinar que no se requiere ningún desafío para autenticar la transacción. O que en base a la información que ha recibido hasta ahora, la transacción no debería continuar.
                                Para los comerciantes europeos y las transacciones dentro del alcance de PSD2, el Emisor también verificará que se pueda aplicar una exención válida.
                            </p>

                            <p>
                                Dependiendo del resultado y del valor de ECI relevante, su aplicación ahora puede proceder a la autorización o mostrar un mensaje al cliente indicándole que su transacción no se realizó correctamente y devolverlo a la página de pago.
                            </p>

                            <p>
                                <b>A continuación mostramos una respuesta de autenticación exitosa.</b>
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="new">var </span><span class="variables">status = threeDSecureData.Status;</span> <span class="comments">// AUTHENTICATION_SUCCESSFUL or CHALLENGE_REQUIRED</span>
                                    <br>
                                    <br>
                                    <span class="comments">// Datos requeridos para la autorización</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">authenticationValue = threeDSecureData.AuthenticationValue;</span> <span class="comments"> // ODQzNjgwNjU0ZjM3N2JmYTg0NTM=s</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">dsTransId = threeDSecureData.DirectoryServerTransactionId;</span> <span class="comments"> // c272b04f-6e7b-43a2-bb78-90f4fb94aa25</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">messageVersion = threeDSecureData.MessageVersion;</span> <span class="comments"> // 2.1.0</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">eci = threeDSecureData.Eci;</span> <span class="comments"> // 05</span>
                                    <br>
                                    <br>
                                    <span class="comments">// Información adicional</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">acsTransId = threeDSecureData.AcsTransactionId;</span> <span class="comments"> // 13c701a3-5a88-4c45-89e9-ef65e50a8bf9</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">statusReason = threeDSecureData.StatusReason;</span> <span class="comments"> // LOW_CONFIDENCE</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">authenticationSource = threeDSecureData.AuthenticationSource;</span> <span class="comments"> // BROWSER</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">messageCategory = threeDSecureData.MessageCategory;</span> <span class="comments"> // PAYMENT_AUTHENTICATION</span>
                                </code>
                            </div>

                            <p class="mt-4">
                                <b>A continuación mostramos una respuesta de autenticación fallida.</b>
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="new">var </span><span class="variables">status = threeDSecureData.Status;</span> <span class="comments">// AUTHENTICATION_FAILED</span>
                                    <br>
                                    <br>
                                    <span class="comments">// Datos requeridos para la autorización</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">authenticationValue = threeDSecureData.AuthenticationValue;</span> <span class="comments"> // ODQzNjgwNjU0ZjM3N2JmYTg0NTM=s</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">dsTransId = threeDSecureData.DirectoryServerTransactionId;</span> <span class="comments"> // c272b04f-6e7b-43a2-bb78-90f4fb94aa25</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">messageVersion = threeDSecureData.MessageVersion;</span> <span class="comments"> // 2.1.0</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">eci = threeDSecureData.Eci;</span> <span class="comments"> // 07</span>
                                    <br>
                                    <br>
                                    <span class="comments">// Información adicional</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">acsTransId = threeDSecureData.AcsTransactionId;</span> <span class="comments"> // 13c701a3-5a88-4c45-89e9-ef65e50a8bf9</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">statusReason = threeDSecureData.StatusReason;</span> <span class="comments"> // CARD_AUTHENTICATION_FAILED</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">authenticationSource = threeDSecureData.AuthenticationSource;</span> <span class="comments"> // BROWSER</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">messageCategory = threeDSecureData.MessageCategory;</span> <span class="comments"> // PAYMENT_AUTHENTICATION</span>
                                </code>
                            </div>

                            <hr>

                            <h5 class="pt-1" id="flujoConFric">
                                6.2 Flujo con fricción
                            </h5>

                            <p>
                                El Emisor determina que se requiere una autenticación adicional para que la transacción continúe.
                                Esto puede deberse a varias razones, incluida una transacción de alto valor, un comportamiento de pago inusual para este cliente en particular (hora del día, tipo de comerciante, etc.) o no coinciden/no se han enviado datos suficientes para que tomen una determinación.
                            </p>
                            <p>
                                La solución de Addon Payments formateará el del desafío con fricción y lo devolverá a su solicitud para que lo envíe al Emisor ACS.
                                La Solicitud de fricción está compuesta por varias variables de transacción, incluidos los identificadores para la autenticación (ID de transacción del servidor, ID de transacción de ACS y el tamaño de la ventana de fricción).
                            </p>

                            <p>
                                Respuesta al desafío
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="comments">// Datos a mostrar al cliente</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">challengeRequestUrl = threeDSecureData.IssuerAcsUrl;</span> <span class="comments">// https://test.portal.gpwebpay.com/pay-sim-gpi/sim/acs</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">encodedCreq = threeDSecureData.PayerAuthenticationRequest;</span> <span class="comments">// Base64 encoded string</span>
                                    <br>
                                    <br>
                                    <span class="comments">// Información adicional</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">authenticationType = threeDSecureData.AuthenticationType;</span> <span class="comments">// DYNAMIC_CHALLENGE</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">challengeMandated = threeDSecureData.ChallengeMandated;</span> <span class="comments">// true</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">statusReason = threeDSecureData.StatusReason;</span> <span class="comments">// LOW_CONFIDENCE</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">authenticationSource = threeDSecureData.AuthenticationSource;</span> <span class="comments">// BROWSER</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">messageCategory = threeDSecureData.MessageCategory;</span> <span class="comments">// PAYMENT_AUTHENTICATION</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">dsTransId = threeDSecureData.DirectoryServerTransactionId;</span> <span class="comments">// c272b04f-6e7b-43a2-bb78-90f4fb94aa25</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">acsTransId = threeDSecureData.AcsTransactionId;</span> <span class="comments">// 13c701a3-5a88-4c45-89e9-ef65e50a8bf9</span>
                                    <br>
                                    <span class="new">var </span><span class="variables">messageVersion = threeDSecureData.MessageVersion;</span> <span class="comments">// 2.1.0</span>
                                </code>
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 6 -->
                    <!-- Punto 7 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="desafioAcs">
                                7. Desafío ACS
                            </h3>

                            <hr>

                            <p>
                                Para facilitar la autenticación, su aplicación/sitio web deberá abrir la URL ACS en un iFrame.
                                El contenido del iFrame se formateará de acuerdo con el parámetro de tamaño de la ventana de desafío indicado en la solicitud de autenticación.
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="pl-2 new"><</span><span class="script">script</span><span class="new">></span>
                                    <br>
                                    <span class="pl-4 require">var </span><span class="variables">form </span><span class="require">= document.</span><span class="service">createElement</span><span class="require">("</span><span class="green">form</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">method</span><span class="require">", "</span><span class="green">POST</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">action</span><span class="require">", "</span><span class="green">https://www.acs.com/challenge</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">target</span><span class="require">", "</span><span class="green">iframe</span><span class="require">");</span>
                                    <br>
                                    <br>
                                    <span class="pl-5 require">var </span><span class="variables">creqData</span> <span class="require">= document.</span><span class="service">createElement</span><span class="require">("</span><span class="green">input</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">threeDSMethodData</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">type</span><span class="require">", "</span><span class="green">hidden</span><span class="require">");</span>
                                    <br>
                                    <span class="pl-5 variables">threeDSMethodData</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">name</span><span class="require">", "</span><span class="green">creq</span><span class="require">");</span>
                                    <br>
                                    <br>
                                    <span class="pl-5 comments">// Añadir el objeto "creq" obtenido del servidor</span>
                                    <br>
                                    <span class="pl-5 variables">creqData</span><span class="require">.</span><span class="service">setAttribute</span><span class="require">("</span><span class="green">value</span><span class="require">", </span><span class="variables">creqObject</span><span class="require">);</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">appendChild</span><span class="require">(</span><span class="variables">creqData</span><span class="require">);</span>
                                    <br>
                                    <span class="pl-5 variables">document.body.</span><span class="require">.</span><span class="service">appendChild</span><span class="require">(</span><span class="variables">form</span><span class="require">);</span>
                                    <br>
                                    <span class="pl-5 variables">form</span><span class="require">.</span><span class="service">submit</span><span class="require">();</span>
                                    <br>
                                    <span class="pl-2 new"><</span><span class="script">/script</span><span class="new">></span>
                                </code>
                            </div>

                            <p class="pt-3">
                                El Emisor ACS determinará el tipo de desafío que se mostrará al cliente y se alineará con al menos dos elementos de la autenticación del cliente:
                                <ul>
                                    <li><b>Possession:</b> Algo que solo el cliente tiene, por ejemplo, su dispositivo móvil registrado en su banco en el que recibirá un código en un SMS.</li>
                                    <li><b>Inherence:</b> Su huella digital u otra forma de datos biométricos.</li>
                                    <li><b>Knowledge:</b> Una frase de contraseña única o la respuesta a una pregunta personal.</li>
                                </ul>
                            </p>
                            <p>
                                Con el cliente en el ACS, pueden ocurrir los siguientes resultados:
                                <ul>
                                    <li><b>La autenticación es exitosa:</b> Transaction Status = Y</li>
                                    <li><b>La autenticación falla y el cliente no tiene otra oportunidad:</b> Transaction Status = N</li>
                                    <li><b>La autenticación falla y el cliente tiene otra oportunidad</b></li>
                                </ul>
                            </p>
                            <p>
                                Una vez que el cliente completa el desafío (independientemente del resultado), el ACS realiza dos acciones:
                                <ul>
                                    <li><b>Primero:</b> Informa a Addon Payments 3DS Solution del resultado y transmite las variables de autenticación.</li>
                                    <li>
                                        <b>Segundo:</b> Al igual que con la URL del método ACS, enviará un mensaje de POST y redirigirá el navegador a su URL de notificación con el Resultado del desafío (CRes).
                                        Su código del lado del cliente podrá detectar la redirección.
                                    </li>
                                </ul>
                            </p>
                            <p>
                                Addon Payments proporciona un simulador Emisor ACS que le permite probar diferentes resultados de desafíos.
                            </p>

                            <hr>

                            <h5 id="simuladorImg">
                                7.1 Simulador ACS
                            </h5>

                            <p>
                                En el entorno sandbox (pruebas), Addon Payments proporciona un simulador de Emisor ACS que le permite probar diferentes resultados de desafíos.
                            </p>

                            <p>
                                Una vez que se haya cargado el desafío, después de diez segundos, el simulador completará automáticamente la autenticación y generará una respuesta de Autenticación exitosa (transStatus = “Y”).
                                Esto tiene la intención de imitar un escenario en el que un cliente ha recibido una notificación en su teléfono para autenticarse usando su aplicación bancaria.
                            </p>

                            <p>
                                Para simular una autenticación fallida, hacer clic en el botón "Cancelar" generará una respuesta fallida (transStatus = “N”).
                                En cualquier escenario, el resultado se enviará en el mensaje de respuesta de desafío (CRes) al punto final de notificación de desafío.
                            </p>
                            <div class="col-12 text-center">
                                <img src="../../../../assets/img/3ds2ACS.png" alt="Simulador ACS">
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 7 -->
                    <!-- Punto 8 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="obtenerDatosAuth">
                                8. Obtener datos de autenticación
                            </h3>

                            <hr>

                            <p>
                                Si la transacción se autentica correctamente (Transaction Status = Y), el paso final antes de procesar la autorización es obtener los datos de autenticación necesarios de la solución Addon Payments 3DS.
                                Estos son los datos que el ACS pasó a Addon Payments cuando el cliente completó el desafío.
                            </p>
                            <p>
                                Para hacer esto, llamamos al endpoint de autenticación con el ID de transacción del servidor 3DS relevante:
                                <ul>
                                    <li>https://api.sandbox.globalpay-ecommerce.com/3ds2/authentications/{server_trans_id}?merchant_id={merchant_id}&request_timestamp={request_timestamp}</li>
                                </ul>
                            </p>
                            <p>
                                Si el cliente canceló la transacción durante el desafío o la autenticación no procedió por otro motivo, el endpoint de resumen también le proporcionará la información disponible para que pueda actualizar su aplicación/sitio web en consecuencia.
                            </p>

                            <p>
                                La información más importante que necesitamos para la autorización es el ECI y el valor de autenticación.
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Entities;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Services;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">Microsoft.AspNetCore.Mvc;</span>
                                    <br>
                                    <br>
                                    <span class="etiqueta">namespace </span><span class="variables">AddonPayments.Controllers._3DS2 {</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">ApiController</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">Route</span><span class="variables">(</span><span class="orange">"api/[Controller]"</span><span class="variables">)]</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 etiqueta">public class </span><span class="imports">DatosAuthController</span><span class="variables">: </span><span class="imports">ControllerBase </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-5 variables">[</span><span class="imports">HttpPost</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-5 etiqueta">public </span><span class="service">IActionResult </span><span class="variables">DatosAuth() {</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Configuramos los datos de nuestro comercio. Los datos son proporcionados por el equipo de Addon Payments,</span>
                                    <br>
                                    <span class="pl-6 comments">// en caso de duda debe llamar al 914 353 028 e indicar su número de comercio o Merchant ID</span>
                                    <br>
                                    <span class="pl-6 imports">ServicesContainer</span><span class="variables">.ConfigureService(</span><span class="new">new </span><span class="imports">GatewayConfig </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantId = </span><span class="orange">"addonnettest"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">AccountId = </span><span class="orange">"3ds2"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">SharedSecret = </span><span class="orange">"secret"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MethodNotificationUrl = </span><span class="orange">"https://dominio.com/notificacion3ds"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ChallengeNotificationUrl = </span><span class="orange">"https://dominio.com/notificacionAcs"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantContactUrl = </span><span class="orange">"https://dominio.com/about"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Secure3dVersion = </span><span class="service">Secure3dVersion</span><span class="variables">.Two</span>
                                    <br>
                                    <span class="pl-6 variables">});</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 imports">ThreeDSecure</span> <span class="variables">threeDSecureData =</span> <span class="new">null</span><span class="variables">;</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                    <br>
                                    <span class="pl-6 new">try </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">threeDSecureData = Secure3dService.</span><span class="imports">GetAuthenticationData</span><span class="variables">()</span>
                                    <br>
                                    <span class="pl-9 variables">.WithServerTransactionId(</span><span class="orange">"6c8c286b-9842-4c74-b298-da640da6ebbd"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-9 variables">.Execute();</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">status = threeDSecureData.Status;</span> <span class="comments">// AUTHENTICATION_SUCCESSFUL or AUTHENTICATION_FAILED</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">authenticationValue = threeDSecureData.AuthenticationValue;</span> <span class="comments">// ODQzNjgwNjU0ZjM3N2JmYTg0NTM=</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">dsTransId = threeDSecureData.DirectoryServerTransactionId;</span> <span class="comments">// c272b04f-6e7b-43a2-bb78-90f4fb94aa25</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">messageVersion = threeDSecureData.MessageVersion;</span> <span class="comments">// 2.1.0</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">eci = threeDSecureData.Eci;</span><span class="comments">// 05</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">acsTransId = threeDSecureData.AcsTransactionId;</span> <span class="comments">// 13c701a3-5a88-4c45-89e9-ef65e50a8bf9</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">statusReason = threeDSecureData.StatusReason;</span> <span class="comments">// LOW_CONFIDENCE</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">authenticationSource = threeDSecureData.AuthenticationSource;</span> <span class="comments">// BROWSER</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">messageCategory = threeDSecureData.MessageCategory;</span> <span class="comments">// PAYMENT_AUTHENTICATION</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 comments">// Devolvemos la respuesta asociando los parámetros recibidos por el servidor al cliente</span>
                                    <br>
                                    <span class="pl-7 comments">// Para más información puede ver el controlador "DatosAuthController.cs"</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 comments">// Aconsejamos guardar los datos de la operacion en su base de datos en caso de querer gestionar de forma interna sus transacciones</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 variables">}</span><span class="new"> catch </span><span class="variables">(</span><span class="imports">ApiException </span><span class="variables">exce</span><span class="variables">) {</span>
                                    <br>
                                    <span class="comments pl-7">// Añada aquí su tratamiento de errores</span>
                                    <br>
                                    <span class="pl-7 new">return </span><span class="variables">Ok(exce);</span>
                                    <br>
                                    <span class="pl-6 variables">}</span>
                                    <br>
                                    <span class="pl-5 variables">}</span>
                                    <br>
                                    <span class="pl-4 variables">}</span>
                                    <br>
                                    <span class="variables">}</span>
                                </code>
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 8 -->
                    <!-- Punto 9 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                            <h3 class="pt-1" id="authDocs">
                                9. Autorización
                            </h3>

                            <hr>

                            <p>
                                Si está procesando el pago con Addon Payments una vez que el proceso 3D Secure esté completo y dependiendo del valor ECI devuelto, podemos proceder con la autorización incluyendo los datos de autenticación.
                                La transacción se procesará con normalidad y puede tener éxito o rechazarse según criterios estándar (fondos suficientes, código de seguridad correcto ingresado...).
                            </p>

                            <div class="p-4 panelCode">
                                <code>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.Entities;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">GlobalPayments.Api.PaymentMethods;</span>
                                    <br>
                                    <span class="etiqueta">using </span><span class="variables">Microsoft.AspNetCore.Mvc;</span>
                                    <br>
                                    <br>
                                    <span class="etiqueta">namespace </span><span class="variables">AddonPayments.Controllers._3DS2 {</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">ApiController</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-4 variables">[</span><span class="imports">Route</span><span class="variables">(</span><span class="orange">"api/[Controller]"</span><span class="variables">)]</span>
                                    <br>
                                    <br>
                                    <span class="pl-4 etiqueta">public class </span><span class="imports">AuthRequestController</span><span class="variables">: </span><span class="imports">ControllerBase </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-5 variables">[</span><span class="imports">HttpPost</span><span class="variables">]</span>
                                    <br>
                                    <span class="pl-5 etiqueta">public </span><span class="service">IActionResult </span><span class="variables">AuthFinal() {</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Configuramos los datos de nuestro comercio. Los datos son proporcionados por el equipo de Addon Payments,</span>
                                    <br>
                                    <span class="pl-6 comments">// en caso de duda debe llamar al 914 353 028 e indicar su número de comercio o Merchant ID</span>
                                    <br>
                                    <span class="pl-6 imports">ServicesContainer</span><span class="variables">.ConfigureService(</span><span class="new">new </span><span class="imports">GatewayConfig </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">MerchantId = </span><span class="orange">"addonnettest"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">AccountId = </span><span class="orange">"3ds2"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">SharedSecret = </span><span class="orange">"secret"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ServiceUrl = </span><span class="orange">"https://remote.sandbox.addonpayments.com/remote"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-6 variables">});</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Creamos el objeto de la tarjeta</span>
                                    <br>
                                    <span class="pl-6 new">var </span><span class="variables">card = </span><span class="new">new </span><span class="imports">CreditCardData </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">Number = </span><span class="orange">"4263970000005262"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ExpMonth = </span><span class="imports">12</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">ExpYear = </span><span class="imports">2025</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Cvn = </span><span class="orange">"131"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">CardHolderName = </span><span class="orange">"Nombre del titular"</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Indicamos la información obtenida en la autenticación 3D Secure 2</span>
                                    <br>
                                    <span class="pl-6 new">var </span><span class="variables">threeDSecureData = </span><span class="new">new </span><span class="imports">ThreeDSecure</span><span class="variables">() {</span>
                                    <br>
                                    <span class="pl-7 variables">AuthenticationValue = </span> <span class="orange">"ODQzNjgwNjU0ZjM3N2JmYTg0NTM="</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">DirectoryServerTransactionId = </span> <span class="orange">"c272b04f-6e7b-43a2-bb78-90f4fb94aa25"</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">Eci = </span> <span class="new">5</span><span class="variables">,</span>
                                    <br>
                                    <span class="pl-7 variables">MessageVersion = </span> <span class="orange">"2.1.0"</span>
                                    <br>
                                    <span class="pl-6 variables">};</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Indicamos la información obtenida en la autenticación 3D Secure 2</span>
                                    <br>
                                    <span class="pl-6 variables">card.</span><span class="imports">ThreeDSecure</span> <span class="variables">= threeDSecureData;</span>
                                    <br>
                                    <span class="pl-6 imports">Transaction</span> <span class="variables">response = </span><span class="new">null</span><span class="variables">;</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 comments">// Lanzamos la petición al servidor de Addon Payments</span>
                                    <br>
                                    <span class="pl-6 new">try </span><span class="variables">{</span>
                                    <br>
                                    <span class="pl-7 variables">threeDSecureData = Secure3dService.</span><span class="imports">InitiateAuthentication</span><span class="variables">(card, threeDSecureData)</span>
                                    <br>
                                    <span class="pl-9 variables">.WithCurrency(</span><span class="orange">"EUR"</span><span class="variables">)</span>
                                    <br>
                                    <span class="pl-9 variables">.Execute();</span>
                                    <br>
                                    <br>
                                    <span class="comments pl-7">// Obtenemos la respuesta y la mostramos</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">result = response.ResponseCode; </span><span class="comments">// 00 == Success</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">message = response.ResponseMessage; </span><span class="comments">// [ test system ] AUTHORISED</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">orderId = response.OrderId; </span><span class="comments">// Order ID de la transacción</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">authCode = response.AuthorizationCode; </span><span class="comments">// Código de autorización</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">paymentsReference = response.TransactionId; </span><span class="comments">// Identificador de transacción (PASREF)</span>
                                    <br>
                                    <span class="pl-7 new">var </span><span class="variables">schemeReferenceData = response.SchemeId; </span><span class="comments">// MMC0F00YE4000000715</span>
                                    <br>
                                    <br>
                                    <span class="pl-7 comments">// Para más información puede ver el controlador "AuthRequestController.cs"</span>
                                    <br>
                                    <span class="pl-7 comments">// Aconsejamos guardar los datos de la operacion en su base de datos en caso de querer gestionar de forma interna sus transacciones</span>
                                    <br>
                                    <br>
                                    <span class="pl-6 variables">}</span><span class="new"> catch </span><span class="variables">(</span><span class="imports">ApiException </span><span class="variables">exce</span><span class="variables">) {</span>
                                    <br>
                                    <span class="comments pl-7">// Añada aquí su tratamiento de errores</span>
                                    <br>
                                    <span class="pl-7 new">return </span><span class="variables">Ok(exce);</span>
                                    <br>
                                    <span class="pl-6 variables">}</span>
                                    <br>
                                    <span class="pl-5 variables">}</span>
                                    <br>
                                    <span class="pl-4 variables">}</span>
                                    <br>
                                    <span class="variables">}</span>
                                </code>
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 9 -->
                    <!-- Punto 10 -->
                    <div class="contenedor">
                        <div class="pl-3 pt-3 pr-3 text-justify">
                            <h3 class="pt-1" id="FormEjemplo1">
                                10. Formulario de ejemplo
                            </h3>

                            <hr>

                            <p>
                                Para poder procesar la transacción con el formulario de ejemplo, debe modificar los archivos alojados en la ruta "vendor\addonpayments\net-sdk\test\net\API\06 - 3DS2\".
                            </p>
                            <p>
                                Debe introducir sus datos de configuración proporcionados por el equipo de soporte de Addon Payments (email: <a href="mailto:soporte@addonpayments.com">soporte@addonpayments.com</a> y teléfono <a href="tel:914353028">914353028</a>):
                                <ul>
                                    <li>Merchant ID</li>
                                    <li>Account</li>
                                    <li>Shared Secret</li>
                                    <li>Method Notification URL (1.0.2 Notificación método 3DS)</li>
                                    <li>Challenge Notification URL (1.0.3 Notificación del desafío ACS)</li>
                                    <li>Merchant Contact URL</li>
                                </ul>
                            </p>

                            <p>
                                Para que el ejemplo funcione correctamente, debe modificar los parámetros "Method Notification URL" y "Challenge Notification URL" según la ruta de su dominio, por ejemplo,
                                si su dominio fuese "https://dominio.com" y quisiera utilizar los arhivos ya configurados en esta guía, debería indicar la siguiente ruta:
                                <ul>
                                    <li><b>Method Notification URL:</b> https://dominio.com/api/n3ds (archivo "net-sdk\examples\AddonPayments\Controllers\3DS2\n3dsController.cs")</li>
                                    <li><b>Challenge Notification URL:</b> https://dominio.com/api/nACS  (archivo "net-sdk\examples\AddonPayments\Controllers\3DS2\nACSController.cs")</li>
                                </ul>
                            </p>

                            <hr>
                            <h5 id="Formulario" class="mt-3">10.1 Formulario</h5>

                            <p>
                                El siguiente formulario le permite enviar una operación contra el entorno de pruebas de Addon Payments.
                            </p>

                            <form id="formulario_envio" method="POST" autocomplete="off" class="col-lg-12" action="/api/ComprobarVersion">
                                <div class="row justify-content-around">
                                    <div class="col-lg-4 pl-lg-4">
                                        <div class="row">
                                            <div class="col-lg-12 mt-2 mb-2 formulario">
                                                <!-- Datos de tarjeta -->

                                                <h4 class="pt-2">
                                                    Datos de tarjeta
                                                    <a data-toggle="collapse" role="button" href="#cardCollapse" title="Placeholder link title" class="btn btn-outline-dark btn-sm float-right">
                                                        Ver tarjetas
                                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-credit-card-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1H0V4z" />
                                                            <path fill-rule="evenodd" d="M0 7v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7H0zm3 2a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H3z" />
                                                        </svg>
                                                    </a>
                                                </h4>
                                                <div class="collapse pb-2" id="cardCollapse">
                                                    <div class="card card-body">
                                                        Frictionless (sin desafío):
                                                        <a onclick="copyToClipboard('#Frictionless')" href="#Frictionless">
                                                            <span id="Frictionless" value="4263 9700 0000 5262">4263 9700 0000 5262</span>
                                                        </a>
                                                        <br>
                                                        Challenge Require (con desafío):
                                                        <a onclick="copyToClipboard('#ChallengeReq')" href="#ChallengeReq">
                                                            <span id="ChallengeReq" value="4012 0010 3848 8884">4012 0010 3848 8884</span>
                                                        </a>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <label for="cardNumber">Número de tarjeta</label>
                                                    <input type="tel" onkeypress="return soloNumeros(event)" maxlength="20" class="form-control" id="cardNumber" name="cardNumber" placeholder="Número de tarjeta" required />
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-6">
                                                        <label>Fecha de exipración</label>
                                                        <input type="tel" value="12/25" maxlength='5' placeholder="MM/YY" class="form-control" id="fExpiry" name="fExpiry" required>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <label for="cvn">Código de seguridad</label>
                                                        <input type="tel" value="131" onkeypress="return soloNumeros(event)" maxlength="4" class="form-control" id="cvn" name="cvn" placeholder="CVN" required />
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="cardholderName">Nombre del titular</label>
                                                    <input type="text" value="James Mason" class="form-control" id="cardholderName" name="cardholder-name" placeholder="Nombre" required />
                                                </div>

                                                <p>
                                                    <input type="hidden" id="importe" name="importe" value="10" />
                                                    <b>Importe:</b> <span>10</span>
                                                </p>
                                                <!-- Datos de tarjeta -->
                                                <div class="form-group row">
                                                    <div class="col-sm-12">
                                                        <button type="submit" onclick="validate();" class="btn btn-block btn-primary">Pagar ahora</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <hr>

                            <h5 id="respuestaForm">
                                10.2 Respuesta de la operación
                            </h5>

                            <small class="form-text text-muted alert alert-primary">
                                --&gt;Para obtener más información sobre la excepción de "try - catch" puede ver la <a target="_blank" href="https://docs.microsoft.com/es-es/dotnet/standard/exceptions/how-to-use-the-try-catch-block-to-catch-exceptions">documentación oficial de .NET</a>
                            </small>

                            <div id="server-results">
                                <h5>
                                    Respuesta del servidor
                                    <a data-toggle="collapse" role="button" href="#collapseExample" title="Placeholder link title" class="btn btn-outline-primary btn-sm float-right">
                                        Ver código
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-code-slash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0zm-.999-3.124a.5.5 0 0 1 .33.625l-4 13a.5.5 0 0 1-.955-.294l4-13a.5.5 0 0 1 .625-.33z"></path>
                                        </svg>
                                    </a>
                                </h5>

                                <div id="server-results1" class="pb-3 mb-2">
                                    <p>
                                        Su respuesta aparecerá aquí.
                                    </p>
                                </div>
                                <div class="collapse pb-2" id="collapseExample">
                                    <div class="card card-body" id="server-resultsCollapse">
                                    </div>
                                </div>
                            </div>

                            <div id="loadIframe" style="display: none;">
                                <hr>
                                <h5 id="loadIframe">
                                    Ejecutando Iframe
                                </h5>
                                <iframe id="hidden_iframe" name="hidden_iframe" style="display: none;"></iframe>
                            </div>

                            <div id="loadResponse" style="display: none;">
                                <hr>
                                <h5>
                                    Respuesta del Iframe
                                    <a data-toggle="collapse" role="button" href="#loadResponseCode" title="Placeholder link title" class="btn btn-outline-primary btn-sm float-right">
                                        Ver código
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-code-slash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0zm-.999-3.124a.5.5 0 0 1 .33.625l-4 13a.5.5 0 0 1-.955-.294l4-13a.5.5 0 0 1 .625-.33z"></path>
                                        </svg>
                                    </a>
                                </h5>
                                <div id="loadResponseText" class="pb-3 mb-2">
                                </div>
                                <div class="collapse pb-2" id="loadResponseCode">
                                    <div class="card card-body" id="loadResponse1">
                                    </div>
                                </div>
                            </div>

                            <div id="paso2" style="display: none;">
                                <hr>
                                <h5>
                                    Respuesta tras enviar ID
                                    <a data-toggle="collapse" role="button" href="#loadChallengeCode" title="Placeholder link title" class="btn btn-outline-primary btn-sm float-right">
                                        Ver código
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-code-slash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0zm-.999-3.124a.5.5 0 0 1 .33.625l-4 13a.5.5 0 0 1-.955-.294l4-13a.5.5 0 0 1 .625-.33z"></path>
                                        </svg>
                                    </a>
                                </h5>
                                <div id="paso2Text" class="pb-3 mb-2">
                                </div>
                                <div class="collapse pb-2" id="loadChallengeCode">
                                    <div class="card card-body" id="paso21">
                                    </div>
                                </div>
                            </div>

                            <div id="loadIframeAcs" style="display: none;">
                                <hr>
                                <h5 id="loadIframeAcs1">
                                    Ejecutando Challenge ACS (desafío)
                                </h5>
                                <iframe id="iframe_3DS_Challenge" name="iframe_3DS_Challenge" src="" class="iframe_3DS_Challenge" width="100%" height="450" style="border: 0px;"></iframe>
                            </div>

                            <div id="loadObtAuth" style="display: none;">
                                <hr>
                                <h5>
                                    Obteniendo autenticación
                                    <a data-toggle="collapse" role="button" href="#loadObtAuthCode" title="Placeholder link title" class="btn btn-outline-primary btn-sm float-right">
                                        Ver código
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-code-slash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0zm-.999-3.124a.5.5 0 0 1 .33.625l-4 13a.5.5 0 0 1-.955-.294l4-13a.5.5 0 0 1 .625-.33z"></path>
                                        </svg>
                                    </a>
                                </h5>
                                <div id="loadObtAuthText" class="pb-3 mb-2">
                                </div>
                                <div class="collapse pb-2" id="loadObtAuthCode">
                                    <div class="card card-body" id="loadObtAuth1">
                                    </div>
                                </div>
                            </div>

                            <div id="loadAuth" style="display: none;">
                                <hr>
                                <h5>
                                    Autenticación
                                    <a data-toggle="collapse" role="button" href="#loadAuthCode" title="Placeholder link title" class="btn btn-outline-primary btn-sm float-right">
                                        Ver código
                                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-code-slash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0zm-.999-3.124a.5.5 0 0 1 .33.625l-4 13a.5.5 0 0 1-.955-.294l4-13a.5.5 0 0 1 .625-.33z"></path>
                                        </svg>
                                    </a>
                                </h5>
                                <div id="loadAuthText" class="pb-3 mb-2">
                                </div>
                                <div class="collapse pb-2" id="loadAuthCode">
                                    <div class="card card-body" id="loadAuth1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /Punto 10 -->

                </div>
                <!-- /Contenido común -->

            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="../../../../assets/js/barraprogreso.js"></script>
    <script src="../../../../assets/js/tarjetaformat.js"></script>

    <!-- Comprobar la versión de la tarjeta -->
    <script>
        // Función para comprobar la validez de la tarjeta
        function validate() {
            var cardNumberCheck = RealexRemote.validateCardNumber(document.getElementById('cardNumber').value);
            var cardHolderNameCheck = RealexRemote.validateCardHolderName(document.getElementById('cardholderName').value);
            var expiryDate = document.getElementById('fExpiry').value;
            var expiryDateFormatCheck = RealexRemote.validateExpiryDateFormat(expiryDate);
            var expiryDatePastCheck = RealexRemote.validateExpiryDateNotInPast(expiryDate);

            if (document.getElementById('cardNumber').value.charAt(0) == "3") {
                cvnCheck = RealexRemote.validateAmexCvn(document.getElementById('cvn').value);
            } else {
                cvnCheck = RealexRemote.validateCvn(document.getElementById('cvn').value);
            }

            if (cardNumberCheck == false || cardHolderNameCheck == false || expiryDateFormatCheck == false || expiryDatePastCheck == false || cvnCheck == false) {
                return false;
            } else {
                return true;
            }
        }

        // Función para copiar las tarjetas al portapapeles
        function copyToClipboard(elementId) {
            var aux = document.createElement("input");
            aux.setAttribute("value", $(elementId)[0].innerHTML);
            document.body.appendChild(aux);
            aux.select();
            document.execCommand("copy");
            document.body.removeChild(aux);
        }

        // Petición AJAX para enviar el formulario sin recargar la web
        $("#formulario_envio").submit(function (event) {
            event.preventDefault();
            var url = $(this).attr("action"); // Valor del campo "action" del formulario
            var method = $(this).attr("method"); // Valor del campo "method" del formulario
            var datos = {
                cardNumber: $("#cardNumber").val().replace(/\s/g, ""),
                month: $("#fExpiry").val().substring(0, 2),
                year: $("#fExpiry").val().substring(3, 5),
                cvn: $("#cvn").val(),
                cardholderName: $("#cardholderName").val(),
                importe: $("#importe").val()
            }

            $.ajax({
                url: url,
                type: method,
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify(datos)
            }).done(function (respuesta) { //                  
                $("#server-resultsCollapse").text(JSON.stringify(respuesta));
                console.log('%c Versión comprobada ', 'color: white; background-color: #2274A5', respuesta);

                if (respuesta.enrolled) {
                    $("#server-results1").text('Tarjeta enrolada correctamente');
                    acsUrl = respuesta.issuerAcsUrl;
                    payerAuth = respuesta.payerAuthenticationRequest;
                    respIframe(acsUrl, payerAuth);
                } else {
                    $("#server-results1").text('Tarjeta no enrolada, se termina la operación');
                }
            });
        });

        // Abrir IFRAME
        function respIframe(acsUrl, payerAuth) {
            var form = document.createElement("form");
            form.setAttribute("method", "POST");
            form.setAttribute("action", acsUrl);
            form.setAttribute("id", "formIframe")
            form.setAttribute("target", "hidden_iframe");

            var threeDSMethodData = document.createElement("input");
            threeDSMethodData.setAttribute("type", "hidden");
            threeDSMethodData.setAttribute("name", "threeDSMethodData");
            // add the JSON object returned by Addon Payments
            threeDSMethodData.setAttribute("value", payerAuth);
            form.appendChild(threeDSMethodData);
            document.body.appendChild(form);
            form.submit();

            $('#hidden_iframe').on('load', function () {
                var iframe = document.getElementById('hidden_iframe');
                var infoIframe = JSON.parse(iframe.contentWindow.document.getElementById('transID').innerText);
                console.log('%c Respuesta del iFrame ACS ', 'color: white; background-color: #199651', infoIframe);
                $("#loadResponse1").text(infoIframe['threeDSServerTransID']);
                $("#loadResponseText").text('Procesado correctamente');
                document.getElementById('hidden_iframe').remove();
                document.getElementById('formIframe').remove();
                $("#loadResponse").css('display', 'block').fadeIn(200);

                requestToServer(infoIframe['threeDSServerTransID'])
            });
        }

    </script>

    <!-- Obtener datos del cliente y enviar solicitud al paso 2 para identificar el Challenge -->
    <script>
        function requestToServer(transId) {
            var colorDepth = screen.colorDepth; // 24
            var javaEnabled = navigator.javaEnabled(); // true
            var browserLanguage = navigator.language; // en_US
            var screenHeight = screen.height; // 1080
            var screenWidth = screen.width; // 1920
            var userAgent = navigator.userAgent;
            // Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36

            var browserTime = new Date();
            var browserTimezoneZoneOffset = (browserTime.getTimezoneOffset() / 60); // 0

            var datos = {
                transId: transId,
                cardNumber: cardNumber,
                fExpiry: fExpiry,
                cvn: cvn,
                cardholderName: cardHolder,
                amount: amount,
                colorDepth: colorDepth,
                javaEnabled: javaEnabled,
                browserLanguage: browserLanguage,
                screenHeight: screenHeight,
                screenWidth: screenWidth,
                userAgent: userAgent,
                browserTimezoneZoneOffset: browserTimezoneZoneOffset
            };

            $.ajax({
                url: '/api/IniciarAuth',
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify(datos)
            }).done(function (respuesta) {
                $("#paso2").css('display', 'block').fadeIn(200);
                $("#paso21").text(JSON.stringify(respuesta));
               
                $("#paso2Text").text(JSON.stringify(respuesta.status));
                console.log('%c Datos para la autorización ', 'color: white; background-color: #2274A5', respuesta);

                if (respuesta.status === "CHALLENGE_REQUIRED") {
                    requestToAcs(respuesta.issuerAcsUrl, respuesta.payerAuthenticationRequest);
                } else if (respuesta.status === "AUTHENTICATION_SUCCESSFUL") {
                    paso4Auth(respuesta.authenticationValue, respuesta.directoryServerTransactionId, respuesta.eci, respuesta.messageVersion)
                }
            });
        }
    </script>

    <!-- Carga del Iframe ACS en caso de recibir Challenge_Required -->
    <script>
        function requestToAcs(challengeUrl, creq) {
            $("#loadIframeAcs").css('display', 'block').fadeIn(200);
            var form = document.createElement("form");
            form.setAttribute("method", "POST");
            form.setAttribute("action", challengeUrl);
            form.setAttribute("target", "iframe_3DS_Challenge");

            var creqData = document.createElement("input");
            creqData.setAttribute("type", "hidden");
            creqData.setAttribute("name", "creq");
            //add creq object obtained from the server
            creqData.setAttribute("value", creq);
            form.appendChild(creqData);

            document.body.appendChild(form);

            form.submit();
        }

        $('iframe#iframe_3DS_Challenge').on('load', function () {
            [acsResponse] = $('#iframe_3DS_Challenge').contents();
            if (acsResponse && acsResponse.body) {
                $('iframe#iframe_3DS_Challenge').css('height', '55px');
                var respuestaACS = JSON.parse(acsResponse.body.innerText);
                console.log('%c Respuesta del iFrame ACS ', 'color: white; background-color: #2274A5', respuestaACS);
                $("#loadIframeAcs1").text('Respuesta del Challenge ACS');

                if (respuestaACS.transStatus === 'Y') {
                    paso3ACS(respuestaACS.threeDSServerTransID);
                } else {
                    $("#loadAuthText").text('Petición cancelada por el usuario');
                    $("#loadAuth").css('display', 'block').fadeIn(200);
                }
            }
        });
    </script>

    <!-- Obtener datos de autenticación -->
    <script>
        function paso3ACS(acsResponse) {
            $.ajax({
                url: '/api/DatosAuth',
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({ acsResponse: acsResponse })
            }).done(function (respuesta) {

                if (respuesta.status === 'AUTHENTICATION_SUCCESSFUL') {
                    var authenticationValue = respuesta.authenticationValue;
                    var directoryServerTransactionId = respuesta.directoryServerTransactionId;
                    var eci = respuesta.eci;
                    var messageVersion = respuesta.messageVersion;

                    $("#loadObtAuth").css('display', 'block').fadeIn(200);
                    $("#loadObtAuthText").text(respuesta.status);
                    $("#loadObtAuth1").text(JSON.stringify(data));

                    paso4Auth(authenticationValue, directoryServerTransactionId, eci, messageVersion);
                } else {
                    $("#loadObtAuth").css('display', 'block').fadeIn(200);
                    $("#loadObtAuth1").text('Autenticación fallida');
                }
            });
        }
    </script>

    <!-- Autorizar operación -->
    <script>
        function paso4Auth(authenticationValue, directoryServerTransactionId, eci, messageVersion) {
            var datos = {
                authenticationValue: authenticationValue,
                directoryServerTransactionId: directoryServerTransactionId,
                eci: eci,
                messageVersion: messageVersion,
                cardNumber: cardNumber,
                fExpiry: fExpiry,
                cvn: cvn,
                cardholderName: cardHolder,
                amount: amount
            };

            $.ajax({
                url: '/api/AuthRequest',
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify(datos)
            }).done(function (respuesta) {
                console.log('%c Respuesta de la autorización ', 'color: white; background-color: #2274A5', respuesta);
                $("#loadAuthText").text(JSON.stringify(respuesta.responseMessage));
                $("#loadAuth1").text(JSON.stringify(respuesta));
                $("#loadAuth").css('display', 'block').fadeIn(200);
            });
        }
    </script>
</body>
</html>